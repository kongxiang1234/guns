<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>情况通报-个人违章积分抵扣</title>
    <link rel="stylesheet" href="${ctxPath}/assets/e365/css/iconfont.css">
    <link rel="stylesheet" href="${ctxPath}/assets/e365/css/layout.css">
    <link rel="stylesheet" href="${ctxPath}/assets/e365/css/pickout.css">
    <style>

        .container{background:url(${ctxPath}/assets/e365/images/casereport/igpointsquery.png) transparent no-repeat center top;background-size:100%;}
        .container input{border:0;}
        .container .wrap_content{width:94%;margin:0 auto;overflow:hidden;}
        .container .wrap_content .top_opera{margin:2vh 0 2.3vh;}
        .container .wrap_content .top_opera form{width:100%;}
        .container .top_opera form ul{width:100%;display:flex;justify-content: space-between;align-items: center;}
        .container .top_opera form li.select{width:70%;}
        .container .top_opera form li.check_btn{width:26%;}
        .container .top_opera form li .pk-input.-clean{height:6vh;line-height:6vh;margin:0;border-radius:10px;font-size:.8rem;padding:0 3vw;}
        .container .top_opera form li.select input::-webkit-input-placeholder{color:#999;}
        .container .top_opera form li.select input::-moz-input-placeholder{color:#999;}
        .container .top_opera form li.select input:-moz-input-placeholder{color:#999;}
        .container .top_opera form li.select input:-ms-input-placeholder{color:#999;}
        .container .top_opera form li.select .pk-arrow{top:0;height:6vh;line-height:6vh;}
        .container .top_opera form li.select .pk-arrow:before{transform:rotate(90deg)}
        .container .top_opera form li.select .pk-arrow.-clean{margin:0 3vw;}
        .container .top_opera form li.check_btn input{width:100%;text-align:center;border-radius:10px;background:#FF7E00;color:#fff;font-size:.8rem;height:6vh;line-height:6vh;}
        .container .infobox{display:flex;justify-content:space-between;align-items: center;width:calc(100% - 6vw);background:#fff;border-radius: 10px;padding:3vh 3vw;margin-top:3.5vh;box-shadow:0px 3px 6px 0px rgba(0, 0, 0, 0.08);}
        .container .infobox .info_text{width:60%;}
        .container .infobox .info_text h5{color:#000;font-size:1rem;font-weight:500;line-height:1;margin:0;}
        .container .infobox .info_text > div{margin:2vh 0;}
        .container .infobox .info_text > div label{color:#999;font-size:.7rem;}
        .container .infobox .info_text > div h6{font-weight:500;color:#000;font-size:.8rem;line-height:1.8;margin:0;}
        .container .infobox .info_text p{font-size:.7rem;color:#999;}
        .container .infobox .info_text p font{font-family:DINPro ;font-size:1.2rem;margin:0 1vw 0 3vw;}
        .container .infobox .info_pic{width:34%;height:18vh;background:#fff;overflow:hidden;}
        .container .infobox .info_pic img{width:100%;height:100%;}
        .container .pointsbox{padding:2vh 0 0;margin:3vh auto 2vh;}
        .container .pointsbox .deductrule{margin:0 3vw; background:rgba(248,252,255,1);border:1px solid rgba(225,239,249,1);}
        .container .pointsbox .deductrule article{margin:2vw;font-size:.75rem;color:#333;line-height:1.8;}
        .container .pointsbox .deductrule article strong{color:#007BFF;}
        .container .pointsbox .form_points{padding:2vh 3vw;box-shadow:0px 3px 6px 0px rgba(0, 0, 0, 0.08);border-radius:10px;margin-bottom:3vh;margin-top:6vh;}
        .container .pointsbox .form_points .form_points_tip{border:1px solid rgba(249,234,234,1);background:#F9EAEA;font-size:.75rem;color:#FF0000;padding:1vh 2vw;width:calc(100% - 4vw);display:block;line-height:1.3;margin-bottom:2vh;}
        .container .pointsbox .form_points table,.container .pointsbox .form_points tr{border:1px solid #D9E6F3;border-collapse: collapse;}
        .container .pointsbox .form_points table{width:100%;margin:0 0 2vh;text-align:center;}
        .container .pointsbox .form_points table th{background:#D9E6F3;color:#437FBF;font-weight:500;}
        .container .pointsbox .form_points table th,.container .pointsbox .form_points table td{padding:2vh 0;font-size:.73rem;}
        .container .pointsbox .form_points table td{color:#333;}
        .container .pointsbox .form_points table input[type="checkbox"]{position:absolute;clip:rect(0,0,0,0)}
        .container .pointsbox .form_points table input[type="checkbox"]+label:before{content:'';display: inline-block;width:4vw;height:5vw;background:url(${ctxPath}/assets/e365/images/casereport/deduct-check.png) no-repeat center;background-size: 100%;}
        .container .pointsbox .form_points table input[type="checkbox"]:checked + label:before{background-size:100% !important;background:url(${ctxPath}/assets/e365/images/casereport/deduct-checked.png) no-repeat center;}
        .container .pointsbox .form_points.f1 th:first-child,.container .pointsbox .form_points.f1 td:first-child{width:40%}
        .container .pointsbox .form_points.f1 th:nth-child(2),.container .pointsbox .form_points.f1 td:nth-child(2){width:30%}
        .container .pointsbox .form_points.f1 th:nth-child(3),.container .pointsbox .form_points.f1 td:nth-child(3){width:15%}
        .container .pointsbox .form_points.f1 th:last-child,.container .pointsbox .form_points.f1 td:last-child{width:15%}
        .container .pointsbox .form_points .deductpoints_detail .form_deduct_year{border-left:4px solid #007BFF;}
        .container .pointsbox .form_points .deductpoints_detail .form_deduct_year strong{font-size: .75rem;color:#333;font-weight:500;margin-left:2vw;}
        .container .pointsbox .form_points .deductpoints_detail ul{width:100%;display:flex;justify-content:space-between;align-items: center;margin:2vh 0 1vh;}
        .container .pointsbox .form_points .deductpoints_detail ul li{width:31%;background-size:100%;text-align:center;padding:2vh 0;}
        .container .pointsbox .form_points .deductpoints_detail ul li p{font-size:.7rem;margin-bottom:1.5vh;}
        .container .pointsbox .form_points .deductpoints_detail ul li p em{font-family:DINPro ;font-size:1.2rem;font-style:normal;margin-right:1vw;}
        .container .pointsbox .form_points .deductpoints_detail ul li span{font-size:.73rem;color:#778079;}
        .container .pointsbox .form_points .deductpoints_detail ul li.yjjf{background:url(${ctxPath}/assets/e365/images/casereport/deductlist-li-bg-1.png) no-repeat center;}
        .container .pointsbox .form_points .deductpoints_detail ul li.yjdk{background:url(${ctxPath}/assets/e365/images/casereport/deductlist-li-bg-2.png) no-repeat center;}
        .container .pointsbox .form_points .deductpoints_detail ul li.wzkf{background:url(${ctxPath}/assets/e365/images/casereport/deductlist-li-bg-3.png) no-repeat center;}
        .container .pointsbox .form_points .deductpoints_detail ul li.yjjf p{color:#007BFF;}
        .container .pointsbox .form_points .deductpoints_detail ul li.yjdk p{color:#2AB149;}
        .container .pointsbox .form_points .deductpoints_detail ul li.wzkf p{color:#FF0000;}
        .container .pointsbox .form_points .confirm_btn{width:100%;margin-top:3vh;}
        .container .pointsbox .form_points .confirm_btn input{width:100%;background:#007BFF;border-radius:10px;font-size:.8rem;color:#fff;border:0;text-align:center;padding:3vh 0;display:block;}
    </style>
</head>
<body>
    <div class="container">
        <div class="wrap_content">
            <div class="top_opera">
                <form target="frameFile" onsubmit="return false;">
                    <ul>
                        <li class="select">
                            <label for="year"></label>
                            <select name="choose" id="year" class="year pickout" placeholder="请选择年份">
                                <option value="2026">2026</option>
                                <option value="2025">2025</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                                <option value="2022">2022</option>
                                <option value="2021">2021</option>
                                <option value="2020">2020</option>
                                <option value="2019">2019</option>
                                <option value="2018">2018</option>
                                <option value="2017">2017</option>
                                <option value="2016">2016</option>
                                <option value="2015">2015</option>
                                <option value="2014">2014</option>
                                <option value="2013">2013</option>
                                <option value="2012">2012</option>
                                <option value="2011">2011</option>
                                <option value="2010">2010</option>

                            </select>
                        </li>
                        <li class="check_btn">
                            <input type="button" value="查询" onclick="sumits()">
                        </li>
                    </ul>
                </form>
            </div>
            <div class="infobox">
                <div class="info_text">
                    <h5>${user.name}</h5>
                    <div>
                        <label>身份证号</label>
                        <h6>${user.email}</h6>
                    </div>
                    <!-- <p>最终违章计分<font color="#FF0000">3</font>分</p> -->
                </div>

            </div>
            <div class="pointsbox">
                <!--<div class="deductrule">
                    <article><strong>抵扣规则：</strong>实现月度安全小测试系统排名前10的人员抵扣本人违章记分1分（1类违章除外），全年可累积，抵扣本人违章记分最多不超过6分，本年度积分有效，年底清零。</article>
                </div>-->
                <div class="form_points f1">
                    <div class="deductpoints_detail">
                        <div class="form_deduct_year">
                            <strong>${year}年度</strong>
                        </div>
                        <ul>
                            <li class="yjjf">
                                <input type="hidden" id="dkwzIntegral" value="${dkwzIntegral}">
                                <p><em>${dkwzIntegral}</em>分</p>
                                <span>有奖积分</span>
                            </li>
                            <li class="yjdk">
                                <input type="hidden" id="total" value="${total}">
                                <p><em>${total}</em>分</p>
                                <span>违章扣分</span>
                            </li>
                            <li >

                            </li>
                        </ul>
                    </div>
                    <table>
                        <tr>
                            <th>违章项</th>
                            <th>督查日期</th>
                            <th>扣分</th>
                            <th>抵扣</th>
                        </tr>
                        @for(item in list){
                            <tr>
                                <td>${item.wzTitle}</td>
                                <td>${item.createUser}</td>
                                <td>${item.num}</td>
                                <td>
                                    <input type="checkbox" name="${itemLP.index}" id="case1${itemLP.index}" value="${item.id}">
                                    <label for="case1${itemLP.index}"></label>
                                </td>
                            </tr>
                        @}

                    </table>
                    <div class="confirm_btn">
                        <input type="button" value="确认抵扣" onclick="dikou()">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="${ctxPath}/assets/e365/js/pickout.js"></script>
    <script src="${ctxPath}/assets/expand/plugins/jquery/jquery-3.2.1.min.js?v=${constants.getReleaseVersion()}"></script>
    <script>
        function sumits(){
            var year=$("#year").val();
            window.location.href="/information/creditDeduction?year="+year
        }
        function dikou(){
            var one=$("input[type='checkbox']:checked");
            if(one.length==0){
                alert("请勾选要抵扣的违章")
                return false
            }
            var array="";
            for (let i = 1; i <one.length+1; i++) {
                array=array+$("input[name="+i+"]:checked").val()+",";
            }
            $.ajax({
                type: 'POST',
                url: '/information/updateDeduction',
                data: {
                    "array":array,
                    "dkwzIntegral":$("#dkwzIntegral").val()
                },
                success: function (data) {
                    if (data.success) {
                        alert(data.message);
                        window.location.href="/information/creditDeduction"

                    } else {
                       alert(data.message);
                    }
                }
            });
        }
        pickout.to({
            el:'.year',
            theme: 'clean'
        });
    </script>
</body>
</html>